var stats,permalink,hex,color,camera,cameraTarget,scene,renderer,group,textMesh1,textMesh2,textGeo,materials;Detector.webgl||Detector.addGetWebGLMessage(),THREE.Cache.enabled=!0;var rot,vel,acc,sphere,congrats=!1,posY=-100,freq=80,audioCtx=new(window.AudioContext||window.webkitAudioContext),gainNode=audioCtx.createGain();gainNode.gain.value=1;var oscillator=audioCtx.createOscillator();oscillator.type="sine",oscillator.connect(gainNode),gainNode.connect(audioCtx.destination),oscillator.start();var firstLetter=!0,text="ciao danielo",height=30,size=20,hover=100,curveSegments=4,bevelThickness=2,bevelSize=1.5,bevelSegments=3,bevelEnabled=!0,font=void 0,fontName="optimer",fontWeight="bold",mirror=!1,fontMap={helvetiker:0,optimer:1,gentilis:2,"droid/droid_sans":3,"droid/droid_serif":4},weightMap={regular:0,bold:1},reverseFontMap=[],reverseWeightMap=[];for(var i in fontMap)reverseFontMap[fontMap[i]]=i;for(var i in weightMap)reverseWeightMap[weightMap[i]]=i;var container,targetRotation=0,targetRotationOnMouseDown=0,mouseX=0,mouseXOnMouseDown=0,windowHalfX=window.innerWidth/2,windowHalfY=window.innerHeight/2,fontIndex=1;function decimalToHex(e){var t=Number(e).toString(16);return(t="000000".substr(0,6-t.length)+t).toUpperCase()}function init(){rot=new THREE.Vector2(0,0),vel=new THREE.Vector2(0,0),acc=new THREE.Vector2(0,0),container=document.createElement("div"),document.body.appendChild(container),permalink=document.getElementById("permalink"),(camera=new THREE.PerspectiveCamera(30,window.innerWidth/window.innerHeight,1,1500)).position.set(0,400,700),cameraTarget=new THREE.Vector3(0,150,0),(scene=new THREE.Scene).background=new THREE.Color(16777215);var e=new THREE.PointLight(16777215,1.5);e.position.set(0,500,90),scene.add(e);var t=document.location.hash.substr(1);if(0!==t.length){t.substring(0,6);var o=t.substring(6,7),n=t.substring(7,8),r=t.substring(8,9),i=t.substring(10);fontName=reverseFontMap[parseInt(o)],fontWeight=reverseWeightMap[parseInt(n)],bevelEnabled=parseInt(r),text=decodeURI(i)}var a=(new THREE.TextureLoader).load("t3.png");a.wrapS=THREE.RepeatWrapping,a.wrapT=THREE.RepeatWrapping;var s=new THREE.SphereGeometry(100,32,32),u=(new THREE.MeshPhongMaterial({color:16777215,shininess:100,map:a}),new THREE.MeshBasicMaterial({map:a}));sphere=new THREE.Mesh(s,u),scene.add(sphere),materials=[new THREE.MeshPhongMaterial({color:16776960,specular:16777215,combine:THREE.MultiplyOperation,shininess:50,reflectivity:1}),new THREE.MeshPhongMaterial({color:16776960,specular:16777215,combine:THREE.MultiplyOperation,shininess:50,reflectivity:1})],(group=new THREE.Group).position.y=10,group.position.x=0,group.position.z=180,scene.add(group),group.visible=!1,loadFont();var c=new THREE.Mesh(new THREE.PlaneBufferGeometry(1e4,1e4),new THREE.MeshBasicMaterial({color:16777215}));c.position.y=100,c.rotation.x=-Math.PI/2,scene.add(c),(renderer=new THREE.WebGLRenderer({antialias:!0})).setPixelRatio(window.devicePixelRatio),renderer.setSize(window.innerWidth,window.innerHeight),container.appendChild(renderer.domElement),stats=new Stats,document.addEventListener("mousedown",onDocumentMouseDown,!1),document.addEventListener("touchstart",onDocumentTouchStart,!1),document.addEventListener("touchmove",onDocumentTouchMove,!1),document.addEventListener("keypress",onDocumentKeyPress,!1),document.addEventListener("keydown",onDocumentKeyDown,!1),window.addEventListener("resize",onWindowResize,!1)}function onWindowResize(){windowHalfX=window.innerWidth/2,windowHalfY=window.innerHeight/2,camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)}function boolToNum(e){return e?1:0}function updatePermalink(){var e=hex+fontMap[fontName]+weightMap[fontWeight]+boolToNum(bevelEnabled)+"#"+encodeURI(text);permalink.href="#"+e,window.location.hash=e}function onDocumentKeyDown(e){if(firstLetter&&(firstLetter=!1,text=""),8==e.keyCode)return e.preventDefault(),text=text.substring(0,text.length-1),refreshText(),!1}function onDocumentKeyPress(e){var t=e.which;if(8==t)e.preventDefault();else{var o=String.fromCharCode(t);text+=o,refreshText()}}function loadFont(){(new THREE.FontLoader).load("fonts/"+fontName+"_"+fontWeight+".typeface.json",function(e){font=e,refreshText()})}function createText(){if((textGeo=new THREE.TextGeometry(text,{font:font,size:size,height:height,curveSegments:curveSegments,bevelThickness:bevelThickness,bevelSize:bevelSize,bevelEnabled:bevelEnabled})).computeBoundingBox(),textGeo.computeVertexNormals(),!bevelEnabled)for(var e=height*size*.1,t=0;t<textGeo.faces.length;t++){var o=textGeo.faces[t];if(1==o.materialIndex){for(var n=0;n<o.vertexNormals.length;n++)o.vertexNormals[n].z=0,o.vertexNormals[n].normalize();var r=textGeo.vertices[o.a],i=textGeo.vertices[o.b],a=textGeo.vertices[o.c];if(THREE.GeometryUtils.triangleArea(r,i,a)>e)for(n=0;n<o.vertexNormals.length;n++)o.vertexNormals[n].copy(o.normal)}}var s=-.5*(textGeo.boundingBox.max.x-textGeo.boundingBox.min.x);(textMesh1=new THREE.Mesh(textGeo,materials)).position.x=s,textMesh1.position.y=hover,textMesh1.position.z=0,textMesh1.rotation.x=0,textMesh1.rotation.y=2*Math.PI,group.add(textMesh1),mirror&&((textMesh2=new THREE.Mesh(textGeo,materials)).position.x=s,textMesh2.position.y=-hover,textMesh2.position.z=height,textMesh2.rotation.x=Math.PI,textMesh2.rotation.y=2*Math.PI,group.add(textMesh2))}function refreshText(){group.remove(textMesh1),mirror&&group.remove(textMesh2),text&&createText()}function onDocumentMouseDown(e){e.preventDefault(),document.addEventListener("mousemove",onDocumentMouseMove,!1),document.addEventListener("mouseup",onDocumentMouseUp,!1),document.addEventListener("mouseout",onDocumentMouseOut,!1),mouseXOnMouseDown=e.clientX-windowHalfX,targetRotationOnMouseDown=targetRotation}function onDocumentMouseMove(e){mouseX=e.clientX-windowHalfX,targetRotation=targetRotationOnMouseDown+.02*(mouseX-mouseXOnMouseDown)}function onDocumentMouseUp(e){document.removeEventListener("mousemove",onDocumentMouseMove,!1),document.removeEventListener("mouseup",onDocumentMouseUp,!1),document.removeEventListener("mouseout",onDocumentMouseOut,!1)}function onDocumentMouseOut(e){document.removeEventListener("mousemove",onDocumentMouseMove,!1),document.removeEventListener("mouseup",onDocumentMouseUp,!1),document.removeEventListener("mouseout",onDocumentMouseOut,!1)}function onDocumentTouchStart(e){1==e.touches.length&&(e.preventDefault(),mouseXOnMouseDown=e.touches[0].pageX-windowHalfX,targetRotationOnMouseDown=targetRotation)}function onDocumentTouchMove(e){1==e.touches.length&&(e.preventDefault(),mouseX=e.touches[0].pageX-windowHalfX,targetRotation=targetRotationOnMouseDown+.05*(mouseX-mouseXOnMouseDown))}function animate(){requestAnimationFrame(animate),render(),stats.update()}function render(){vel.add(acc),rot.add(vel),acc.multiplyScalar(0),sphere.rotation.y=rot.x,sphere.position.y>200&&(congrats=!0,group.visible=!0),congrats?sphere.position.y=200:(sphere.position.y=100*-vel.x,vel.multiplyScalar(.995)),oscillator.frequency.setValueAtTime(800*vel.x,audioCtx.currentTime),gainNode.gain.value=vel.x,group.rotation.y+=.015,camera.lookAt(cameraTarget),renderer.clear(),renderer.render(scene,camera)}function MouseWheelHandler(e){e.deltaY<0&&(acc.x+=.01),e.deltaY>0&&(console.log("-"),acc.x-=.01)}init(),animate(),(container=document.body).addEventListener?(container.addEventListener("mousewheel",MouseWheelHandler,!1),container.addEventListener("DOMMouseScroll",MouseWheelHandler,!1)):container.attachEvent("onmousewheel",MouseWheelHandler),document.addEventListener("touchstart",handleTouchStart,!1),document.addEventListener("touchmove",handleTouchMove,!1);var xDown=null,yDown=null;function handleTouchStart(e){xDown=e.touches[0].clientX,yDown=e.touches[0].clientY}function handleTouchMove(e){if(xDown&&yDown){var t=e.touches[0].clientX,o=e.touches[0].clientY,n=xDown-t,r=yDown-o;Math.abs(n)>Math.abs(r)||(r>0?acc.x+=.12:acc.x-=.12),xDown=null,yDown=null}}
